<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:WarehouseStockOpname.ViewModels"
             xmlns:zxing="clr-namespace:ZXing.Net.Maui.Controls;assembly=ZXing.Net.MAUI.Controls"
             x:Class="WarehouseStockOpname.Views.ScannerPage"
             x:DataType="viewmodels:ScannerViewModel"
             Title="Scan Barcode">

    <Grid RowDefinitions="*,Auto,Auto" Padding="0">
        
        <!-- Barcode Scanner -->
        <zxing:CameraBarcodeReaderView Grid.Row="0"
                                        x:Name="cameraBarcodeReaderView"
                                        IsDetecting="{Binding IsScanning}"
                                        BarcodesDetected="OnBarcodesDetected"/>

        <!-- Last Scanned Info -->
        <Frame Grid.Row="1" 
               BackgroundColor="#2196F3" 
               Padding="15" 
               Margin="0"
               CornerRadius="0"
               IsVisible="{Binding LastScannedProduct, Converter={StaticResource IsNotNullConverter}}">
            <VerticalStackLayout>
                <Label Text="Last Scanned:" 
                       FontSize="12" 
                       TextColor="White" 
                       FontAttributes="Bold"/>
                <Label Text="{Binding LastScannedProduct.Name}" 
                       FontSize="16" 
                       TextColor="White"/>
                <Label Text="{Binding LastScannedSKU, StringFormat='SKU: {0}'}" 
                       FontSize="12" 
                       TextColor="White"/>
            </VerticalStackLayout>
        </Frame>

        <!-- Action Buttons -->
        <Grid Grid.Row="2" ColumnDefinitions="*,*" Padding="10">
            <Button Grid.Column="0" 
                    Text="Manual Entry"
                    Command="{Binding ManualEntryCommand}"
                    BackgroundColor="#FF9800"
                    TextColor="White"
                    Margin="5"
                    CornerRadius="10"/>
            
            <Button Grid.Column="1" 
                    Text="Back"
                    Command="{Binding GoBackCommand}"
                    BackgroundColor="#757575"
                    TextColor="White"
                    Margin="5"
                    CornerRadius="10"/>
        </Grid>

        <!-- Scanning Overlay -->
        <Grid Grid.Row="0" 
              BackgroundColor="#80000000"
              IsVisible="{Binding IsScanning, Converter={StaticResource InvertedBoolConverter}}">
            <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center">
                <Label Text="Scanner Paused" 
                       FontSize="20" 
                       TextColor="White" 
                       FontAttributes="Bold"
                       HorizontalOptions="Center"/>
                <ActivityIndicator IsRunning="True" 
                                 Color="White" 
                                 WidthRequest="50" 
                                 HeightRequest="50"/>
            </VerticalStackLayout>
        </Grid>
    </Grid>
</ContentPage>
